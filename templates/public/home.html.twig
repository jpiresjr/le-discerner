{% extends 'public/layout.html.twig' %}

{% block content %}
<!-- Banner Principal (Hero) -->
<header id="hero" class="hero-ipg">
    <div class="hero-ipg__bg"></div>

    <div class="container-lg hero-ipg__content">
        <h1 class="hero-ipg__title">WELCOME</h1>
        <p class="hero-ipg__sub">
            Discover a personalised experience, centred on you. Here, your well-being comes first.
            Connect with qualified, dedicated professionals who genuinely care about you.
        </p>

        <div class="d-flex flex-wrap gap-2 justify-content-center">
            <button type="button" class="btn btn-ipg-cta" data-bs-toggle="modal" data-bs-target="#authModal" data-form="paciente">
                Client
            </button>
            <button type="button" class="btn btn-ipg-outline" data-bs-toggle="modal" data-bs-target="#authModal" data-form="profissional">
                Professional
            </button>
        </div>
    </div>
</header>

<!-- Seção Bem-vindo -->
<section id="bem-vindo" class="welcome-section py-5">
    <div class="container" data-aos="fade-up">
        <div class="welcome-card">
            <span class="welcome-kicker">Nossa essência</span>
            <h2 class="welcome-title">Bem-vindo</h2>
            <div class="welcome-divider"></div>
            <p>A Integrative Psychotherapy Group é uma clínica sediada em Beverly Hills, dedicada a oferecer uma ampla gama de serviços de psicoterapia para indivíduos, casais, famílias e grupos.</p>
            <p>Utilizamos princípios psicodinâmicos contemporâneos para ajudar os clientes a abordar suas preocupações e adotar uma abordagem focada em profundidade na terapia.</p>
            <p>Nosso objetivo é ajudar os clientes a obter insights tanto sobre experiências passadas quanto presentes, a fim de capacitá-los a tomar decisões informadas que levem a mudanças significativas.</p>
        </div>
    </div>
</section>

<!-- Seção Psicoterapia Consciente -->
<section id="psicoterapia-consciente" class="ipg-therapy-section">
    <div class="container" data-aos="fade-up">
        <div class="row align-items-center">

            <!-- CARD (ESQUERDA) -->
            <div class="col-md-6">
                <div class="ipg-therapy-card">

                    <h2 class="ipg-therapy-title">Psicoterapia Consciente</h2>

                    <p class="ipg-therapy-text">
                        Focamos em uma ampla gama de modalidades de tratamento
                        para aqueles que buscam se beneficiar da psicoterapia:
                    </p>

                    <!-- linha animada -->
                    <div class="ipg-divider" data-aos="divider"></div>

                    <ul class="ipg-therapy-list">
                        <li>Individual</li>
                        <li>Casal</li>
                        <li>Família</li>
                        <li>Grupo</li>
                    </ul>

                    <a href="#" class="btn btn-ipg-cta mt-3">
                        Agende uma Consulta
                    </a>

                </div>
            </div>

            <!-- IMAGEM (DIREITA) -->
            <div class="col-md-6">
                <div class="ipg-therapy-image">
                    <img src="/images/moca-home.jpeg"
                         alt="Psicoterapia Consciente">
                </div>
            </div>

        </div>
    </div>
</section>

<!-- Seção Abordagem Focada em Profundidade -->
<section id="abordagem-profundidade" class="depth-section">
    <div class="container">
        <div class="depth-card" data-aos="fade-up">
            <h2>
                Abordagem Focada em Profundidade<br>
                <small>na Psicoterapia</small>
            </h2>
            <hr class="section-divider">
            <p>
                Nossa metodologia busca explorar insights mais profundos sobre si mesmo
                para ajudar os clientes a tomar decisões mais informadas e saudáveis
                sobre seu presente e futuro.
            </p>
            <p>
                Acreditamos que, através do trabalho conjunto entre cliente e terapeuta,
                um crescimento significativo é possível.
            </p>
            <a href="#" class="btn btn-ipg-cta mt-3">Learn more</a>
        </div>
    </div>
</section>

<!-- Seção Therapies (Home) -->
<section id="home-therapies" class="py-5">
    <div class="container" data-aos="fade-up">

        <div class="text-center mb-5">
            <h2 class="fw-light">Our Therapeutic Approaches</h2>
            <p class="text-muted">Choose the path that resonates most with you</p>
        </div>

        <div class="row g-4">

            <!-- Psicanálise -->
            <div class="col-md-4">
                <div class="therapy-card">
                    <div class="therapy-card__img" style="background-image:url('/images/Psicanalise.jpeg');"></div>
                    <div class="therapy-card__content">
                        <h5>Psychoanalyst</h5>
                        <a href="/therapies#psicanalise" class="btn btn-ipg-cta w-100">
                            Learn more
                        </a>
                    </div>
                </div>
            </div>

            <!-- Terapia Integrativa -->
            <div class="col-md-4">
                <div class="therapy-card">
                    <div class="therapy-card__img" style="background-image:url('/images/Terapia-integrativa.jpeg');"></div>
                    <div class="therapy-card__content">
                        <h5>Integrative Therapist</h5>
                        <a href="/therapies#terapia-integrativa" class="btn btn-ipg-cta w-100">
                            Learn more
                        </a>
                    </div>
                </div>
            </div>

            <!-- Coaching -->
            <div class="col-md-4">
                <div class="therapy-card">
                    <div class="therapy-card__img" style="background-image:url('/images/Coaching.jpeg');"></div>
                    <div class="therapy-card__content">
                        <h5>Personal Development Coach</h5>
                        <a href="/therapies#coaching" class="btn btn-ipg-cta w-100">
                            Learn more
                        </a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
<section id="profissionais-destaque" class="py-5">
    <div class="container">

        <!-- TÍTULO -->
        <div class="text-center mb-5">
            <h2 class="section-title">Featured Professionals</h2>
            <p class="section-subtitle">
                Carefully selected specialists to support your journey.
            </p>
        </div>

        <!-- CARROSSEL -->
        <div id="carouselProfissionais" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {% if featuredProfessionals is not empty %}
                    {% for slide in featuredProfessionals %}
                        <div class="carousel-item {{ loop.first ? 'active' : '' }}">
                            <div class="row g-4 justify-content-center">
                                {% for professional in slide %}
                                    <div class="col-md-6 col-lg-4">
                                        <div class="professional-card h-100">
                                            <div class="professional-image">
                                                <img src="{{ professional.photo }}" alt="Profissional">
                                            </div>
                                            <div class="professional-body">
                                                <h5>{{ professional.name }}</h5>
                                                <span>{{ professional.specialty ?: 'Especialidade não informada' }}</span>
                                                <p>{{ professional.description }}</p>
                                                <a href="/professionals/{{ professional.id }}" class="btn btn-ipg-cta w-100">Ver Perfil</a>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="carousel-item active">
                        <div class="row g-4 justify-content-center">
                            <div class="col-12">
                                <div class="alert alert-light text-center">
                                    Nenhum profissional em destaque disponível no momento.
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

            </div>

            <!-- CONTROLES -->
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselProfissionais" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselProfissionais" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Próximo</span>
            </button>
        </div>
    </div>
</section>

<!-- Modal -->
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border-radius:16px; overflow:hidden;">
            <div class="modal-header" style="background:rgba(62,69,51,.96); color:#feffff;">
                <h5 class="modal-title" id="authModalTitle">Cadastro</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body p-0">
                <div id="authModalBody" class="p-4">
                    <div class="text-center py-5">
                        <div class="spinner-border" role="status" aria-hidden="true"></div>
                        <div class="mt-3">Carregando formulário…</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block inline_javascripts %}
<script>
    AOS.init();

    (() => {
        const nav = document.getElementById('mainNavbar');
        const hero = document.getElementById('hero');
        const bg = document.querySelector('.hero-ipg__bg');
        const content = document.querySelector('.hero-ipg__content');

        function onScroll(){
            const y = window.scrollY || 0;

            // navbar muda ao rolar
            nav.classList.toggle('scrolled', y > 10);

            // parallax (fundo desce mais devagar)
            if (hero && bg){
                const heroH = hero.offsetHeight;
                const p = Math.min(1, y / heroH);
                bg.style.transform = `translateY(${y * 0.25}px) scale(1.06)`;

                // texto dá uma "sumida" leve ao rolar
                if (content){
                    content.style.opacity = (1 - p * 0.55).toFixed(3);
                    content.style.transform = `translateY(${p * 18}px)`;
                }
            }
        }

        window.addEventListener('scroll', onScroll, { passive:true });
        onScroll();
    })();

    (function () {
        const modalEl = document.getElementById('authModal');
        const modalTitle = document.getElementById('authModalTitle');
        const modalBody = document.getElementById('authModalBody');

        const pages = {
            paciente: "/pages/auth/cadastro-paciente.php",
            profissional: "/pages/auth/cadastro-profissional.php"
        };

        function loading(){
            modalBody.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border" role="status" aria-hidden="true"></div>
                    <div class="mt-3">Carregando formulário…</div>
                </div>
            `;
        }

        modalEl.addEventListener('show.bs.modal', async (event) => {
            const btn = event.relatedTarget;
            const type = btn?.getAttribute('data-form') || 'paciente';

            modalTitle.textContent = (type === 'profissional') ? 'Criar Conta — Profissional' : 'Criar Conta — Paciente';

            const url = pages[type];
            if (!url) {
                modalBody.innerHTML = `<div class="alert alert-danger">Página do formulário não configurada.</div>`;
                return;
            }

            try {
                loading();
                const res = await fetch(url, { headers: { "X-Requested-With": "XMLHttpRequest" }});
                const html = await res.text();
                modalBody.innerHTML = html;
            } catch (err) {
                modalBody.innerHTML = `<div class="alert alert-danger">Erro ao carregar o formulário.</div>`;
            }
        });
    })();
</script>
{% endblock %}
